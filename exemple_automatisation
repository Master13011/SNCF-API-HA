alias: Alerte Trains SNCF
triggers:
  - entity_id:
      - sensor.sncf_tous_les_trains_ligne
      - sensor.sncf_tous_les_trains_ligne_2
    attribute: has_delay
    to: "true"
    trigger: state
actions:
  - choose:
      - conditions:
          - condition: or
            conditions:
              - condition: template
                value_template: >
                  {% set dep_time =
                  state_attr('sensor.sncf_XXXX_2','departure_time')
                  %} {% set hm = dep_time.split(' - ')[1] %} {{ hm != '07:54' }}
              - condition: state
                entity_id: >-
                  sensor.sncf_XXXX_2
                attribute: has_delay
                state: "true"
        sequence:
          - data:
              title: Train en retard ou supprimé
              message: |
                Le train de 07h54 n'est pas à l'heure. Départ prévu: {{
                  state_attr('sensor.sncf_XXXX_2','departure_time')
                }}
            action: notify.notify
      - conditions:
          - condition: or
            conditions:
              - condition: template
                value_template: >
                  {% set dep_time =
                  state_attr('sensor.sncf_XXXX_3','departure_time')
                  %} {% set hm = dep_time.split(' - ')[1] %} {{ hm != '08:07' }}
              - condition: state
                entity_id: >-
                  sensor.sncf_XXX_3
                attribute: has_delay
                state: "true"
        sequence:
          - data:
              title: Train en retard ou supprimé
              message: |
                Le train de 08h07 n'est pas à l'heure. Départ prévu: {{
                  state_attr('sensor.sncf_XXX_3','departure_time')
                }}
            action: notify.notify
